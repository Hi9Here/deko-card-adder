<link rel="import" href="../paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../card-info-link-input/card-info-link-input.html">
<link rel="import" href="../paper-button-group/paper-button-group.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../paper-input/paper-textarea.html">
<link rel="import" href="../content-card/content-card.html">
<link rel="import" href="../link-display/link-display.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../input-image/input-image.html">
<link rel="import" href="../deko-cards/deko-cards.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-styles/color.html">
<dom-module id="deko-card-editor">
  <template>
    <style>
      #cardInputs {
        margin: 15px
      }
      .templateButtons {
        text-align: center;
        margin-top: 40px;
      }
      paper-button-group {
        margin: 15px;
      }
      paper-fab {
        position: fixed;
        right: 25px;
        bottom: 30px;          
      }
    </style>
    <template is="dom-if" if="[[!noAdd]]">
      <paper-fab icon="add" on-tap="add"></paper-fab>
    </template>
    <paper-dialog id="dialog" modal>
      <paper-dialog-scrollable>
        <template is="dom-if" if="[[pickType]]">
          <template is="dom-repeat" items="[[objectToArray(theTemplates)]]">
            <deko-card card="[[item]]" icon="[[item.icon]]" on-open="addThis"></deko-card>
          </template>
        </template>
        <template is="dom-if" if="[[!pickType]]">
          <div id="cardInputs" inner-h-t-m-l="[[inputFrom]]"></div>
        </template>
      </paper-dialog-scrollable>
      <div class="buttons">
        <paper-button on-tap="delete" style="color:#333">Delete</paper-button>
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button on-tap="save" raised style="background:#ff4081;color:#fff">Save</paper-button>
      </div>
    </paper-dialog>
  </template>
  <script>
    Polymer({
      is: 'deko-card-editor',
      properties: {
        card:{
          type: Object,
          notify: true,
        },
        inputFrom:{
          computed: ("getThis(usedTemplate.input)"),
        },
        updateValues: {
          computed: ("getUpdateValues(card.*)")
        },
        usedTemplate: {
          computed: "getUsedTemplate(theTemplates, card, useTemplates, useTemplate)"
        },
        noAdd:{
          type:Boolean,
          value:false,
        },
        pickType:{
          type:Boolean,
          value:false,
        },
        useTemplates: {
          type: Object,
          value: ""
        },
        useTemplate: {
          value: "link-display"
        },
        theTemplates: {
          value:{
            "link-display": {
              title: "link",
              image:"data:image/png;base64,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",
              input: "<card-info-link-input label=\"link\"></card-info-link-input>", 
              icon: "bookmark",
              locked: "true",
              cardType: "link-display",
            },
            "content-card": {
              title: "content",
              input: "<input-image label=\"Image\"></input-image><paper-input label=\"title\"></paper-input><paper-input label=\"desc\"></paper-input><image-input label=\"image\"></image-input>", 
              icon: "chrome-reader-mode",
              cardType: "content-card",
              locked: "true",
            },
          }
        },
        theTemplate: {
          computed: "setTemplate(useTemplate, usedTemplate, theTemplates, useTemplates)"
        }
      },
      getThis: function(inputForm) {
        this.async(this.getUpdateValues, 100) // let it load
        return inputForm
      },
      addThis: function(e,d) {
        console.log(e,d)
        if (d) {
          this.useTemplate = d
          this.pickType = false
        }
      },
      getInputFrom: function(form) {
        this.async(this.getUpdateValues, 100) // let it load
        return form
      },
      getUsedTemplate: function(theTemplates, card, useTemplates, useTemplate) {
        if (!useTemplates) {
          return theTemplates[useTemplate]
        } else {
          if (typeof useTemplates === "string") {
            useTemplates = JSON.parse(useTemplates)
          }
          return this.objectToArray(useTemplates)[0]["__key"]
        }
        // rem \/
        return this.objectToArray(theTemplates).reduce(function(previousValue, currentValue){
          if (currentValue.output == card.output) {
            return currentValue["$key"]
          } else {
            return previousValue
          }
        }, "")
      },
      setTemplate: function(useTemplate, usedTemplate, theTemplates, useTemplates) {
        if (!this.card){
          this.card = {}
        }
        if (useTemplates) {
          if (typeof useTemplates === "string") {
            useTemplates = JSON.parse(useTemplates)
          }
          this.card.cardType = useTemplates[useTemplate].cardType
          return this.card.input = useTemplates[useTemplate].input
        } else if (useTemplate) {
          this.card.cardType = theTemplates[useTemplate].cardType
          return this.card.input = theTemplates[useTemplate].input
        } else if (this.card.input) {
          return this.card.input
        }
      },
      getUpdateValues: function(card) {
        if (card) {
          this.async(this.getUpdateValues, 100) // let it load
        } else {
          if (!this.card) {
            this.card = {}
          }
          var inputForm = this.$$("#cardInputs")
          var items = inputForm.querySelectorAll("[label]")
          for (var i=0, max=items.length; i < max; i++) {
            if (this.card.hasOwnProperty(items[i].label)) {
              items[i].value = this.card[items[i].label]
            }
          }
          return "Done"
        }
      },
      save: function() {
        if (!this.card){
          this.card = {}
        }
        if (this.card.cardIcon) {
          delete(this.card.cardIcon)
        }
        var inputForm = this.$$("#cardInputs")
        var items = inputForm.querySelectorAll("[label]")
        for (var i=0, max=items.length; i < max; i++) {
          if (items[i].value) {
            this.card[items[i].label] = items[i].value
          }
        }
        this.close('save')
      },
      delete: function() {
        this.close('delete')
      },
      close: function(detail) {
        var inputForm = this.$$("#cardInputs")
        var items = inputForm.querySelectorAll("[label]")
        for (var i=0, max=items.length; i < max; i++) {
          this.card[items[i].label] = items[i].value
        }
        if (this.__editedCardElement) {
          this.__editedCardElement.style.opacity = 1
          this.__editedCardElement = null
        }
        this.fire('close', detail, { bubbles: false })
        this.$.dialog.close()
      },
      add: function() {
        this.open()
      },
      open: function(card) {
        if (card) {
          if (this.theTemplates[card.cardType]) {
            this.useTemplate = card.cardType
          } else {
            this.pickType = true
          }
          this.card = card
        } else {
          this.card = {}
          this.pickType = true
        }
        this.async(this.getUpdateValues, 100)
        this.$.dialog.open()
      },
      objectToArray: function(data) { //rewrite as .map
        var output = []
        if (data) {
          var keys = Object.keys(data)
          for (var i = 0; i < keys.length; i++) {
            if (typeof data[keys[i]] === 'object') {
              data[keys[i]]["__key"] = keys[i]
              output.push(data[keys[i]])
            }
          }
        }
        return output
      }
    })
  </script>
</dom-module>
